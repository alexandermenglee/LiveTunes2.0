@{

    ViewData["Title"] = "Index";
}

<script src="https://maps.googleapis.com/maps/api/js?key=@GoogleMapsAPIToken.Token&callback=initMap" type="text/javascript"></script>
<script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>


<select class="genres">
</select>

<style>
    #eventList{
        width: 100%;
        height: 100%;
    }
    #eventList div{
        width: 100%;
        height: 100%;
        padding-bottom: 10px;
    }
</style>

<div id="eventList">

</div>
<script src="~/js/Genre.js"></script>


<script type="text/javascript">
    x = navigator.geolocation;
    x.getCurrentPosition(success, failure);
    var events;
    function success(position) {
        var coordinates = {
            longitude: position.coords.longitude,
            latitude: position.coords.latitude
        }
            $.post({
                url: 'Event/Handoff',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(coordinates),
                dataType: "json",
                success: function (recData) {
                    events = recData;
                    var eventList = document.getElementById("eventList");
                    console.log("Success" + recData);
                    eventList.innerHTML = "";
                    for (let i = 0; i < recData.length; i++) {
                        console.log(recData[i]);
                        eventList.innerHTML += '<div class="card">\
                                <div class="card-header">\
                                    ' + recData[i].eventName + '\
                                </div>\
                                <div class="card-body container">\
                                    <div class="row">\
                                        <div class="col-3">\
                                            <img />\
                                        </div>\
                                        <div class="col-9">\
                                            <h5 class="card-title">Name: </h5>\
                                            <h5 class="card-title">Date:' + recData[i].dateTime + ' </h5>\
                                            <h5 class="card-title">Time: </h5>\
                                            <h5 class="card-title">Genre:' + getGenre(recData[i].genre) + ' </h5>\
                                        </div>\
                                        <a href="/event/details/'+ recData[i].eventId +'"><input type="button" value="Go"/></a>\
                                    </div>\
                                </div>\
                            </div>';

                    }
                }
            });

        function getEventsByGenre(genreId) {
                    events = recData;
                    var eventList = document.getElementById("eventList");
                    console.log("Success" + recData);
                    eventList.innerHTML = "";
                    for (let i = 0; i < recData.length; i++) {
                        console.log(recData[i]);
                        eventList.innerHTML += '<div class="card">\
                                <div class="card-header">\
                                    ' + recData[i].eventName + '\
                                </div>\
                                <div class="card-body container">\
                                    <div class="row">\
                                        <div class="col-3">\
                                            <img />\
                                        </div>\
                                        <div class="col-9">\
                                            <h5 class="card-title">Name: </h5>\
                                            <h5 class="card-title">Date:' + recData[i].dateTime + ' </h5>\
                                            <h5 class="card-title">Time: </h5>\
                                            <h5 class="card-title">Genre:' + getGenre(recData[i].genre) + ' </h5>\
                                        </div>\
                                        <a href="/event/details/'+ recData[i].eventId +'"><input type="button" value="Go"/></a>\
                                    </div>\
                                </div>\
                            </div>';

                    }
        }
    }


    function failure() {
        alert("Could not retrieve location.");
    }
</script>